{% extends 'base.html' %}

{% block content %}
{% load static %}

<div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1" >
  <div class="modal-dialog modal-xl modal-dialog-centered">
  	<div class="modal-content" style="background-color: rgba(219, 232, 255, 0.8)!important;">
  	  <div class="modal-header" style="border-bottom-color: #a7bac7;">
  	  	<div class="col-md-8">
  	  		<h4>
  	  			<h5 class="modal-title" id="onbModalLabel" style="display: inline;"> </h5> 
  	  		  	<small class="text-muted">'s Onboarding Summary</small>
  	  		</h4>
  	  	</div>
  	    <h5 class="modal-title" id="onbModalLabel"> </h5>
  	    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  	  </div>
  	  <div class="modal-body" id="modal_body">

  	  </div>
      <div class="modal-footer text-left" style="border-top-color: #a7bac7;">
      		<small class="text-muted">Hint: The tiles are scrollable.</small>
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="exampleModalToggle2" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1" >
  <div class="modal-dialog modal-xl modal-dialog-centered">
 <div class="modal-content" style="background-color: rgba(219, 232, 255, 0.8)!important;">
 	      <div class="modal-header" style="border-bottom-color: #a7bac7;">
 	      	<div class="col-md-8">
 	      		<h4>
 	      			<h5 class="modal-title" id="onbModalLabel-1" style="display: inline;"> </h5> 
 	      		  	<small class="text-muted">'s Onboarding Summary</small>
 	      		</h4>
 	      	</div>
 	        <h5 class="modal-title" id="onbModalLabel"> </h5>
 	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
 	      </div>
 	      <div class="modal-body" id="modal_body-1">

 	      </div>

      <div class="modal-footer" style="border-top-color: #a7bac7;">
        <button class="btn btn-primary" class="btn btn-outline-secondary btn-sm back-overview" data-bs-target="#exampleModalToggle" data-bs-toggle="modal">&laquo; Back</button>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="new_link_Modal" tabindex="-1" aria-labelledby="newlinkModalLabel" aria-hidden="true" >
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    	<form id="form" method="POST">
	      <div class="modal-header">
	        <h5 class="modal-title" id="newlinkModalLabel">New Resource</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body row g-3 justify-content-center">
      			<div class="col-sm-9">
	      		  	<input type="text" id="res_key" class="form-control" placeholder="Title" aria-label="Title" required>
      			</div>
	      	  	<div class="col-sm-9">
	      	  	  	<input type="text" id="res_val" class="form-control" placeholder="Value" aria-label="Value" required>
	      	  	</div>
	      </div>
	      <div class="modal-footer">
	      	<button class="btn  btn-outline-secondary" class="btn btn-outline-secondary btn-sm back-overview" data-bs-target="#exampleModalToggle" data-bs-toggle="modal">&laquo; Back</button>
	        <input type="submit" class="btn btn-outline-primary create-res" value="Save"></button>

	      </div>
    	</form>
      
    </div>
  </div>
</div>

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
  </symbol>
  <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
  </symbol>
  <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
  </symbol>
</svg>

{% if user.profile.phone == '' %}

<center>
	<div class="alert alert-danger d-flex align-items-center" role="alert" style="width: 75%; margin-top: 40px;">
	  <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
	  <div>
	    It seems like you haven't updated your phone number on your account yet. Please navigate to your profile settings or <a href="/profile/" class="alert-link">click here</a> to update now.
	  </div>
	</div>
</center>

{% endif %}
	<div class="container-md home-content">
		<div class="row">
			<div class="col">
				<img class="salesforce" src="{% static 'sf_heroku.png' %}" style="max-height: 160px; filter: drop-shadow(0 0.1rem 0.1rem rgba(0, 0, 0, 0.2)); " alt="My image"/>
				<blockquote class="blockquote">
					<p class="h5 welcome-font text-muted"><strong>Welcome Back, {{ user.profile.firstname }}!</strong></p>		
				</blockquote>
			</div>
			<hr>
		</div>
	</div>

	<div class="container-md">
		<div class="">
			<div class="col-md-8">
				<h4>
					New Hire Onboarding 
				  	<small class="text-muted">Live&nbsp;</small>
				  	<img src="{% static '/green_led_2.png' %}" style="max-height: 10px;" alt="My image"/>
				</h4>
			</div>
		</div>
		<div class="gap-3" style="margin: auto;">
			<div class="row">
				<div class="col p-2 mx-auto">
					<nav>
						<div class="nav nav-tabs" id="nav-tab" role="tablist">
						    <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">NH Cards</button>
						    <button class="nav-link" id="nav-finished-tab" data-bs-toggle="tab" data-bs-target="#nav-finished" type="button" role="tab" aria-controls="nav-finished" aria-selected="false">NH Onboarded</button>
						    <!--<button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Overview</button>-->
						    <!--<button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-accesses" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">New Hire Access Requests</button>
						    <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-weeks" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">New Hire Weeks</button>
						    <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-targets" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">New Hire Targets</button>-->
					    </div>
					</nav>
					<div class="tab-content" id="nav-tabContent" >
						<div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
							<br>
							<div class="container-md">
						    <div class="row row-cols-1 row-cols-lg-3 g-2 g-lg-3">
						    	{% for u in usr %}
						    	{% for onb in onb %}
						    	{% if u.username == onb.newhire %}
						    	{% if not onb.finished %}
						        <div class="col">
						        	<div class="p-3 border bg-card" style="background-image: url({% static 'startup.png' %}); background-size: 100%;">
							      	  <h4 class="fw-bolder nh-name">{{u.profile.firstname}} {{u.profile.lastname}}</h4><hr>
											  <table class="table table-borderless table-sm table-responsive">
											   	<tbody>
												  	<tr>
											   			<td><b>Trail Guide</b></td>
											   			{% for usr in usr %}
											   			{% if usr.username == onb.trailguide %}
											   			<td>{{usr.profile.firstname}} {{ usr.profile.lastname }}</td>
											   			{% endif %}
											   			{% endfor %}
											   		</tr>
											   		<tr>
											   			<td><b>Onboarding Buddy</b></td>
											   			{% for usr in usr %}
											   			{% if usr.username == onb.onboardingbuddy %}
											   			<td>{{usr.profile.firstname}} {{ usr.profile.lastname }}</td>
											   			{% endif %}
											   			{% endfor %}
											   		</tr>
											   		<tr>
											   			<td><b>Manager</b></td>
											   			{% for usr in usr %}
											   			{% if usr.username == onb.the_manager %}	
											   			<td>{{usr.profile.firstname}} {{ usr.profile.lastname }}</td>
											   			{% endif %}
											   			{% endfor %}
											   		</tr>
											   		<tr>
											   			<td><b>Onboarding Start</b></td>
											   			<td>{{u.profile.startdate}}</td>
											   		</tr>
										   			<tr>
										   				<td><b>Onboarding End</b></td>
										   				<td>{{u.profile.enddate}}</td>
										   			</tr>
											   	</tbody>
											  </table>
											  <center>
									   			<button class="btn btn-outline-primary btn-sm view-details" data-bs-toggle="modal" href="#exampleModalToggle" role="button">View Details</button>
									   		</center>
						    			</div>
						    		</div>
						    	{% endif %}
						    	{% endif %}
						    	{% endfor %}
						    	{% endfor %}
						  	</div>
							</div>
							<br>
				 		</div>
		 				<div class="tab-pane fade show" id="nav-finished" role="tabpanel" aria-labelledby="nav-finished-tab">
		 					<br>
		 					<div class="container-md">
		 				    <div class="row row-cols-1 row-cols-lg-3 g-2 g-lg-3">
		 				    	{% for u in usr %}
		 				    	{% for onb in onb %}
		 				    	{% if u.username == onb.newhire %}
		 				    	{% if onb.finished %}
		 				        <div class="col">
		 				        	<div class="p-3 border bg-card" style="background-image: url({% static 'startup.png' %}); background-size: 100%;">
		 					      	  <h4 class="fw-bolder nh-name">{{u.profile.firstname}} {{u.profile.lastname}}</h4><hr>
		 									  <table class="table table-borderless table-sm table-responsive">
		 									   	<tbody>
		 										  	<tr>
		 									   			<td><b>Trail Guide</b></td>
		 									   			{% for usr in usr %}
		 									   			{% if usr.username == onb.trailguide %}
		 									   			<td>{{usr.profile.firstname}} {{ usr.profile.lastname }}</td>
		 									   			{% endif %}
		 									   			{% endfor %}
		 									   		</tr>
		 									   		<tr>
		 									   			<td><b>Onboarding Buddy</b></td>
		 									   			{% for usr in usr %}
		 									   			{% if usr.username == onb.onboardingbuddy %}
		 									   			<td>{{usr.profile.firstname}} {{ usr.profile.lastname }}</td>
		 									   			{% endif %}
		 									   			{% endfor %}
		 									   		</tr>
		 									   		<tr>
		 									   			<td><b>Manager</b></td>
		 									   			{% for usr in usr %}
		 									   			{% if usr.username == onb.the_manager %}	
		 									   			<td>{{usr.profile.firstname}} {{ usr.profile.lastname }}</td>
		 									   			{% endif %}
		 									   			{% endfor %}
		 									   		</tr>
		 									   		<tr>
		 									   			<td><b>Onboarding Start</b></td>
		 									   			<td>{{u.profile.startdate}}</td>
		 									   		</tr>
		 								   			<tr>
		 								   				<td><b>Onboarding End</b></td>
		 								   				<td>{{u.profile.enddate}}</td>
		 								   			</tr>
		 									   	</tbody>
		 									  </table>
		 									  <center>
		 							   			<button class="btn btn-outline-primary btn-sm view-details" data-bs-toggle="modal" href="#exampleModalToggle" role="button">View Details</button>
		 							   		</center>
		 				    			</div>
		 				    		</div>
		 				    	{% endif %}
		 				    	{% endif %}
		 				    	{% endfor %}
		 				    	{% endfor %}
		 				  	</div>
		 					</div>
		 					<br>
		 		 		</div>


					  	<!--
						<div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" >
							<br>
							<form id="check_form">
							<div class="container" style="max-width: 70%;" style="background-image: url({% static 'overview.png' %}); background-size: 50%; background-repeat:no-repeat; background-position: center;">
								<div class="input-group">
									<select class="form-select" id="newhire">
								    <option  value="" selected disabled hidden>Choose...</option>
								    {% for usr in usr %}
								    {% for onb in onb %}
								    {% if usr.username == onb.newhire %}
								    <option value="{{onb.newhire}}">{{usr.profile.firstname}} {{usr.profile.lastname}}</option>
								    {% endif %}
								    {% endfor %}
								    {% endfor %}
								    </select>
								    <input type="submit" class="btn btn-outline-secondary" value="Check" style="width: 20%;">
							   </div>
							</div>
							</form>
							<br>
							<div class="container-md" id='nh_content'>
								
							</div>
						</div>

						<div class="tab-pane fade" id="nav-accesses" role="tabpanel" aria-labelledby="nav-profile-tab">
							<br>
							<form id="check_accesses">
							<div class="container" style="max-width: 70%;" style="background-image: url({% static 'overview.png' %}); background-size: 50%; background-repeat:no-repeat; background-position: center;">
								<div class="input-group">
									<select class="form-select" id="newhire_accesses">
								    <option  value="" selected disabled hidden>Choose...</option>
								    {% for usr in usr %}
								    {% for onb in onb %}
								    {% if usr.username == onb.newhire %}
								    <option value="{{onb.newhire}}">{{usr.profile.firstname}} {{usr.profile.lastname}}</option>
								    {% endif %}
								    {% endfor %}
								    {% endfor %}
								    </select>
								    <input type="submit" class="btn btn-outline-secondary" value="Check" style="width: 20%;">
							   </div>
							</div>
							</form>
							<br>
							<div class="container-md" id='nh_accessses'>
								
							</div>
						</div>

						<div class="tab-pane fade" id="nav-weeks" role="tabpanel" aria-labelledby="nav-profile-tab">
							<br>
							<form id="check_weeks">
							<div class="container" style="max-width: 70%;" style="background-image: url({% static 'overview.png' %}); background-size: 50%; background-repeat:no-repeat; background-position: center;">
								<div class="input-group">
									<select class="form-select" id="newhire_weeks">
								    <option  value="" selected disabled hidden>Choose...</option>
								    {% for usr in usr %}
								    {% for onb in onb %}
								    {% if usr.username == onb.newhire %}
								    <option value="{{onb.newhire}}">{{usr.profile.firstname}} {{usr.profile.lastname}}</option>
								    {% endif %}
								    {% endfor %}
								    {% endfor %}
								    </select>
								    <input type="submit" class="btn btn-outline-secondary" value="Check" style="width: 20%;">
							   </div>
							</div>
							</form>
							<br>
							<div class="container-md" id='nh_weeks'>
								
							</div>
						</div>

						<div class="tab-pane fade" id="nav-targets" role="tabpanel" aria-labelledby="nav-profile-tab">
							<br>
							<form id="check_targets">
							<div class="container" style="max-width: 70%;" style="background-image: url({% static 'overview.png' %}); background-size: 50%; background-repeat:no-repeat; background-position: center;">
								<div class="input-group">
									<select class="form-select" id="newhire_targets">
								    <option  value="" selected disabled hidden>Choose...</option>
								    {% for usr in usr %}
								    {% for onb in onb %}
								    {% if usr.username == onb.newhire %}
								    <option value="{{onb.newhire}}">{{usr.profile.firstname}} {{usr.profile.lastname}}</option>
								    {% endif %}
								    {% endfor %}
								    {% endfor %}
								    </select>
								    <input type="submit" class="btn btn-outline-secondary" value="Check" style="width: 20%;">
							   </div>
							</div>
							</form>
							<br>
							<div class="container-md" id='nh_targets'>
								
							</div>
						</div>
-->
					</div>
				</div>
			</div>
		</div>
	</div>

	<div aria-live="polite" aria-atomic="true" class="d-flex justify-content-center align-items-center w-100">
	    <div class="toast border-0 position-fixed top-0 toast-bg" data-bs-delay="1500" role="alert" aria-live="assertive" aria-atomic="true" style="opacity: 1 !important;">
		    <div class="d-flex">
			    <div class="toast-body" style="text-align:center;">
			      
			    </div>
		    	<button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
		    </div>
	    </div>
	</div>

	<script type="text/javascript">
		$(document).ready(function(){

			$('#check_form').on('submit', function(e) {
				e.preventDefault();

				$.ajax({
					type: 'POST',
					url: 'check_form/',
					data: {
						name: $('#newhire').val(),
						csrfmiddlewaretoken: '{{ csrf_token }}',
					},
					success: function(data) {
						$('#nh_content').html(data);
					}
				})
			});

			$('#check_accesses').on('submit', function(e) {
				e.preventDefault();

				$.ajax({
					type: 'POST',
					url: 'check_accesses/',
					data: {
						name: $('#newhire_accesses').val(),
						csrfmiddlewaretoken: '{{ csrf_token }}',
					},
					success: function(data) {
						$('#nh_accesses').html(data);
					}
				})
			});

			$('#check_weeks').on('submit', function(e) {
				e.preventDefault();

				$.ajax({
					type: 'POST',
					url: 'check_weeks/',
					data: {
						name: $('#newhire_weeks').val(),
						csrfmiddlewaretoken: '{{ csrf_token }}',
					},
					success: function(data) {
						$('#nh_weeks').html(data);
					}
				})
			});

			$('#check_targets').on('submit', function(e) {
				e.preventDefault();

				$.ajax({
					type: 'POST',
					url: 'check_targets/',
					data: {
						name: $('#newhire_targets').val(),
						csrfmiddlewaretoken: '{{ csrf_token }}',
					},
					success: function(data) {
						$('#nh_targets').html(data);
					}
				})
			});

			$('.view-details').on('click', function(e) {
				e.preventDefault();

				var nh_name = $(this).closest("div").find("h4").text();
				console.log(nh_name)
				$.ajax({
					type:'POST',
					url:'view_details/',
					data: {
						name: nh_name,
						csrfmiddlewaretoken: '{{ csrf_token }}',
					},
					success: function(data) {
						$('#onbModalLabel').text(nh_name);
						$('#modal_body').html(data);
					}
				})
			})

			$('.back-overview').on('click', function(e) {
				e.preventDefault();

				var nh_name = $('#onbModalLabel').text();
				$.ajax({
					type:'POST',
					url:'view_details/',
					data: {
						name: nh_name,
						csrfmiddlewaretoken: '{{ csrf_token }}',
					},
					success: function(data) {
						$('#onbModalLabel').text(nh_name);
						$('#modal_body').html(data);
					}
				})
			})

				$('#form').on('submit', function(e) {
					e.preventDefault();
					var nh_name = $('#onbModalLabel').text();
					$.ajax({
						type: 'POST',
						url: 'add_resource/',
						data: {
							key: $('#res_key').val(),
							value: $('#res_val').val(),
							nh_name: nh_name,
							csrfmiddlewaretoken: '{{ csrf_token }}',
						},
						success: function() {
							$('.modal').find('form').trigger('reset');
							$('.modal').modal('hide');
							$('div.toast-body').text('Resource added!');
							var toastElList = [].slice.call(document.querySelectorAll('.toast'))
							var toastList = toastElList.map(function (toastEl) {
								return new bootstrap.Toast(toastEl)
							});
							toastList.forEach(toast => toast.show());
							setTimeout(function() {window.location.reload()}, 900);
						},
						error: function() {
							alert('Adding resource failed!')
						}

					});
				});

			});

			function edit_res(key, value) {
				$('#res_key').val(key);
				$('#res_val').val(value);
			}

			$('.del_res').on('click', function(e) {
				e.preventDefault();
				var nh_name = $('#onbModalLabel').text();

				var row = $(this).closest("tr");
				$.ajax({
					type: 'POST',
					url: 'del_resource/',
					data: {
						key: row.find("td:eq(0)").text(),
						nh_name: nh_name,
						csrfmiddlewaretoken: '{{ csrf_token }}',
					},
					success: function(){ 
						$('div.toast-body').text('Resource Deleted!');
						var toastElList = [].slice.call(document.querySelectorAll('.toast'))
						var toastList = toastElList.map(function (toastEl) {
							return new bootstrap.Toast(toastEl)
						});
						toastList.forEach(toast => toast.show());
						setTimeout(function() {window.location.reload()}, 900);
					},
					error: function() {
						alert('Deleting resource failed!')
					}
				});

		});

		function week_content(id){
			var nh_name = $('#onbModalLabel').text();
			$.ajax({
				type: 'POST',
				url: 'check_content/',
				data: {
					name: $('#onbModalLabel').text(),
					week_id: id,
					csrfmiddlewaretoken: '{{ csrf_token }}',
				},
				success: function(data) {
					$('#onbModalLabel-1').text(nh_name);
					$('#modal_body-1').html(data);
				}
			});
		};
		
		$(document).on('click', '.finish-onb',function (e) {
			e.preventDefault();
			
			$.ajax({
				type: 'POST',
				url: 'nh_onboarded/',
				data: {
					username: $('#onbModalLabel').text(),
					csrfmiddlewaretoken: '{{ csrf_token }}',
				},
				success: function() {
						$('div.toast-body').text('Successfully marked onboarding as complete!');
						var toastElList = [].slice.call(document.querySelectorAll('.toast'))
						var toastList = toastElList.map(function (toastEl) {
							return new bootstrap.Toast(toastEl)
						});
						toastList.forEach(toast => toast.show());
						setTimeout(function() {window.location.reload()}, 900);
					},
					error: function() {
						alert('Marking onboarding as complete failed!');
					}
			})

		})
		$(document).on('click', '.back-onb',function (e) {
			e.preventDefault();
			
			$.ajax({
				type: 'POST',
				url: 'nh_not_onboarded/',
				data: {
					username: $('#onbModalLabel').text(),
					csrfmiddlewaretoken: '{{ csrf_token }}',
				},
				success: function() {
						$('div.toast-body').text('Marked onboarding as not yet complete!');
						var toastElList = [].slice.call(document.querySelectorAll('.toast'))
						var toastList = toastElList.map(function (toastEl) {
							return new bootstrap.Toast(toastEl)
						});
						toastList.forEach(toast => toast.show());
						setTimeout(function() {window.location.reload()}, 900);
					},
					error: function() {
						alert('Marking onboarding as not completed failed!');
					}
			})

		})
	</script>
{% endblock %}
